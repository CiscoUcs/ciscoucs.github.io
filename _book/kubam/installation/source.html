
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>VM based Installation Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="security.html" />
    
    
    <link rel="prev" href="ubuntu.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">UCS Developer Resources</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../../API.html">
            
                <a href="../../API.html">
            
                    
                    UCS API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../../PROGRAMMING.html">
            
                <a href="../../PROGRAMMING.html">
            
                    
                    Programming Languages
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../../CFGMGMT.html">
            
                <a href="../../CFGMGMT.html">
            
                    
                    Configuration Management
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../../OS/">
            
                <a href="../../OS/">
            
                    
                    Operating Systems
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.4.1" data-path="../../OS/COREOS.html">
            
                <a href="../../OS/COREOS.html">
            
                    
                    CoreOS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4.2" data-path="../../OS/REDHAT.html">
            
                <a href="../../OS/REDHAT.html">
            
                    
                    RedHat
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="../../CONTAINERS/">
            
                <a href="../../CONTAINERS/">
            
                    
                    Containers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="../../SUPPORT.html">
            
                <a href="../../SUPPORT.html">
            
                    
                    Support
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">KUBAM</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../">
            
                <a href="../">
            
                    
                    KUBAM Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="./">
            
                <a href="./">
            
                    
                    Installation
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.2.1" data-path="standard.html">
            
                <a href="standard.html">
            
                    
                    Standard CentOS/RedHat Installation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.2" data-path="ubuntu.html">
            
                <a href="ubuntu.html">
            
                    
                    Standard Ubuntu Installation
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="3.2.3" data-path="source.html">
            
                <a href="source.html">
            
                    
                    VM based Installation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.4" data-path="security.html">
            
                <a href="security.html">
            
                    
                    Security
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.5" data-path="network.html">
            
                <a href="network.html">
            
                    
                    Networking
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.6" data-path="other.html">
            
                <a href="other.html">
            
                    
                    Other Tricky Installation Tips
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../configure/">
            
                <a href="../configure/">
            
                    
                    Configuration
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.3.1" data-path="../configure/creds.md">
            
                <span>
            
                    
                    Credentials
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.2" data-path="../configure/network.md">
            
                <span>
            
                    
                    Networking
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.3" data-path="../configure/servers.md">
            
                <span>
            
                    
                    Servers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.4" data-path="../configure/iso.md">
            
                <span>
            
                    
                    Boot Images
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.5" data-path="../configure/settings.html">
            
                <a href="../configure/settings.html">
            
                    
                    Settings
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.6" data-path="../configure/template.html">
            
                <a href="../configure/template.html">
            
                    
                    Kickstart Templates
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.7" data-path="../configure/windows.html">
            
                <a href="../configure/windows.html">
            
                    
                    Windows Support (alpha)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="../internals/">
            
                <a href="../internals/">
            
                    
                    KUBAM Glorious Underbelly
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.4.1" data-path="../internals/stage1/docker.html">
            
                <a href="../internals/stage1/docker.html">
            
                    
                    Stage1 - Docker
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4.2" data-path="../internals/stage1/esxi.html">
            
                <a href="../internals/stage1/esxi.html">
            
                    
                    Stage1 - ESXi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4.3" data-path="../internals/stage1/manual.html">
            
                <a href="../internals/stage1/manual.html">
            
                    
                    Stage1 - Manual
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4.4" data-path="../internals/stage2/python.html">
            
                <a href="../internals/stage2/python.html">
            
                    
                    Stage2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4.5" data-path="../internals/stage3/ansible.html">
            
                <a href="../internals/stage3/ansible.html">
            
                    
                    Stage3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4.6" data-path="../internals/stage4/manual.html">
            
                <a href="../internals/stage4/manual.html">
            
                    
                    Stage4
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="../developer/">
            
                <a href="../developer/">
            
                    
                    KUBAM Developer
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.5.1" data-path="../developer/API.html">
            
                <a href="../developer/API.html">
            
                    
                    KUBAM API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.5.2" data-path="../developer/YAML.html">
            
                <a href="../developer/YAML.html">
            
                    
                    KUBAM YAML
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >VM based Installation</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="kubam-installation-from-source-no-docker">KUBAM Installation from source (No Docker)</h1>
<p>For those who are appalled by the mere mention of the word &quot;docker&quot; we are not going to leave you hanging.  Here is how you could install it from source. </p>
<div class="alert alert-warning">
<b>Note</b> This is a work in progress and is still being updated.  We will hopefully simplify this as time goes on. 
</div>

<h3 id="big-picture">Big Picture</h3>
<p>Before beginning let&apos;s examine what we&apos;re actually doing here.  We have two microservices that we are trying to put on the same server and make them coexist. </p>
<p>The services are:</p>
<ul>
<li>KUBAM API - Back end Python Flask application.</li>
<li>KUBAM GUI - NodeJS React application that talks to back end. </li>
</ul>
<p>The KUBAM API also needs to present the <code>/kubam</code> directory to the servers so they can mount and run. </p>
<p>What we do is we front end everything with nginx.  Nginx will then have proxy ports to call either the API or the GUI depending on how it comes in.  We&apos;ll make all calls to port 80 go to the KUBAM API unless they are going to the <code>/kubam</code> directory, then it will go to the shared directory there.  All calls to port <code>5000</code> will then route to the GUI.  In this way it will work similar to how the microservices version of KUBAM works. </p>
<p>So, to make everything work we do the following: </p>
<ul>
<li>Install all the dependencies</li>
<li>Install the source files</li>
<li>Start the applications</li>
<li>Start NGINX to frontend and point to the right services. </li>
</ul>
<p>Sounds easy right?   </p>
<h2 id="1-install-prerequisites">1. Install Prerequisites</h2>
<p>In this sample we&apos;ll use 7.3</p>
<h2 id="11-additional-repos">1.1 Additional Repos</h2>
<pre><code>rpm -Uvh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm \
            http://ftp.tu-chemnitz.de/pub/linux/dag/redhat/el7/en/x86_64/rpmforge/RPMS/rpmforge-release-0.5.3-1.el7.rf.x86_64.rpm \
            https://forensics.cert.org/cert-forensics-tools-release-el7.rpm
</code></pre><h2 id="12-yum-prereqs">1.2 YUM prereqs</h2>
<pre><code>yum -y install xorriso \
    python-jinja2 \
   PyYAML \
   fuseext2 \
   nginx \
   mkisofs \
   python-flask \
   gcc \
   python-devel \
   git \
   epel-release \
   gcc-c++ \
   make
</code></pre><h2 id="13-nodejs--pip">1.3 NodeJS &amp; Pip</h2>
<h3 id="131-pip">1.3.1 PIP</h3>
<p>Pip provides an easy way to get python modules and dependencies on our system.  We need it for the UCS APIs.</p>
<pre><code>curl https://bootstrap.pypa.io/get-pip.py | python - &amp;&amp; \
    pip install ucsmsdk flask_cors sshpubkeys
</code></pre><h3 id="132-node">1.3.2 Node</h3>
<p>NPM and Node are how we serve up front end web interfaces.</p>
<p>Grab the NODE repos</p>
<pre><code>curl --silent --location https://rpm.nodesource.com/setup_8.x | sudo bash -
</code></pre><p>Install Node</p>
<pre><code>yum -y install nodejs
</code></pre><h2 id="14-git-kubam-repos">1.4 Git KUBAM Repos</h2>
<pre><code>git clone https://github.com/CiscoUcs/KUBaM.git
git clone https://github.com/CiscoUcs/KUBAM-Frontend.git
</code></pre><h2 id="15-configure-services">1.5 Configure Services</h2>
<pre><code>cd KUBaM/kubam
</code></pre><p>Depending on which version of nginx you have it may be either:</p>
<pre><code>cp files/default /etc/nginx.conf.d
</code></pre><p>or</p>
<pre><code>cp files/default /etc/nginx/conf.d/
</code></pre><p>Then copy the rest of the files:</p>
<pre><code>mkdir -p /usr/share/kubam/
cp -a files/stage1 /usr/share/kubam/stage1
cp -a templates /usr/share/kubam/
cp -a ansible /usr/share/kubam/
cp -a scripts/* /usr/bin/
</code></pre><p>Copy the application</p>
<pre><code>cp -a app /
</code></pre><p>Edit the <code>app.py</code> and add this line to the first part of the file: </p>
<pre><code>#!/usr/bin/env python
</code></pre><p>Then make it executable:</p>
<pre><code>chmod 755 /app/app.py
</code></pre><h3 id="kubam-web">KUBAM Web</h3>
<pre><code>mkdir -p /kubam-web
mv ~/KUBAM-Frontend/build /kubam-web/
</code></pre><h2 id="16-kubamyaml">1.6 <code>kubam.yaml</code></h2>
<p>Create the KUBAM directory:</p>
<pre><code>mkdir -p /usr/share/nginx/html/kubam
touch /kubam/kubam.yaml
</code></pre><p>Now we can add a basic configuration to the kubam file just to test something out. Edit <code>/kubam/kubam.yaml</code> and make it say something like: </p>
<pre><code>hosts:
- ip: 172.28.225.131
  name: kubam01
  os: centos7.3
  role: &apos;&apos;
</code></pre><h2 id="17-systemd">1.7 Systemd</h2>
<h3 id="171-kubamservice">1.7.1 <code>kubam.service</code></h3>
<p>Make Systemd init file.  Create a file called <code>/etc/systemd/system/kubam.service</code></p>
<p>Make the contents of this file be:</p>
<pre><code>[Unit]
Description=kubam

[Service]
ExecStart=/app/app.py
</code></pre><h3 id="172-kubam-webservice">1.7.2 <code>kubam-web.service</code></h3>
<p>Make Systemd init file.  Create a file called <code>/etc/systemd/system/kubam-web.service</code></p>
<p>Make the contents of this file be:</p>
<pre><code>[Unit]
Description=kubam-web

[Service]
ExecStart=serve -s /kubam-web/build --port 5002
</code></pre><h3 id="173-start-kubam-services">1.7.3 Start KUBAM services</h3>
<p>Next start up the kubam server: </p>
<pre><code>systemctl daemon-reload
systemctl enable kubam
systemctl enable kubam-web
systemctl start kubam
systemctl start kubam-web
</code></pre><h2 id="18-test-kubam-is-up">1.8 Test KUBAM is up</h2>
<p>You should be able to run <code>curl localhost:5000 | python -m json.tool</code> and get back an answer like: </p>
<pre><code>{
    &quot;status&quot;: &quot;ok&quot;
}
</code></pre><p>At this point the API is up and running. </p>
<p>Next we need to get the GUI up and running. </p>
<h2 id="19-install-gui">1.9 Install GUI</h2>
<pre><code>cd ~/KUBAM-Frontend   
npm install
npm run build
npm install -g serve
serve -s build
</code></pre>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="ubuntu.html" class="navigation navigation-prev " aria-label="Previous page: Standard Ubuntu Installation">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="security.html" class="navigation navigation-next " aria-label="Next page: Security">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"VM based Installation","level":"3.2.3","depth":2,"next":{"title":"Security","level":"3.2.4","depth":2,"path":"kubam/installation/security.md","ref":"kubam/installation/security.md","articles":[]},"previous":{"title":"Standard Ubuntu Installation","level":"3.2.2","depth":2,"path":"kubam/installation/ubuntu.md","ref":"kubam/installation/ubuntu.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"kubam/installation/source.md","mtime":"2018-03-07T06:48:58.063Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-04-26T13:38:52.562Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

