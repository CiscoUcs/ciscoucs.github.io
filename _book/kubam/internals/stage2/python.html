
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Stage2 Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../stage3/ansible.html" />
    
    
    <link rel="prev" href="../stage1/manual.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../../">
            
                <a href="../../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">UCS Developer Resources</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../../../API.html">
            
                <a href="../../../API.html">
            
                    
                    UCS API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../../../PROGRAMMING.html">
            
                <a href="../../../PROGRAMMING.html">
            
                    
                    Programming Languages
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../../../CFGMGMT.html">
            
                <a href="../../../CFGMGMT.html">
            
                    
                    Configuration Management
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../../../OS/">
            
                <a href="../../../OS/">
            
                    
                    Operating Systems
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.4.1" data-path="../../../OS/COREOS.html">
            
                <a href="../../../OS/COREOS.html">
            
                    
                    CoreOS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4.2" data-path="../../../OS/REDHAT.html">
            
                <a href="../../../OS/REDHAT.html">
            
                    
                    RedHat
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="../../../CONTAINERS/">
            
                <a href="../../../CONTAINERS/">
            
                    
                    Containers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="../../../SUPPORT.html">
            
                <a href="../../../SUPPORT.html">
            
                    
                    Support
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">KUBAM</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../../">
            
                <a href="../../">
            
                    
                    KUBAM Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../../installation/">
            
                <a href="../../installation/">
            
                    
                    Installation
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.2.1" data-path="../../installation/standard.html">
            
                <a href="../../installation/standard.html">
            
                    
                    Standard CentOS/RedHat Installation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.2" data-path="../../installation/ubuntu.html">
            
                <a href="../../installation/ubuntu.html">
            
                    
                    Standard Ubuntu Installation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.3" data-path="../../installation/source.html">
            
                <a href="../../installation/source.html">
            
                    
                    VM based Installation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.4" data-path="../../installation/security.html">
            
                <a href="../../installation/security.html">
            
                    
                    Security
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.5" data-path="../../installation/network.html">
            
                <a href="../../installation/network.html">
            
                    
                    Networking
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.6" data-path="../../installation/other.html">
            
                <a href="../../installation/other.html">
            
                    
                    Other Tricky Installation Tips
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../../configure/">
            
                <a href="../../configure/">
            
                    
                    Configuration
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.3.1" data-path="../../configure/creds.md">
            
                <span>
            
                    
                    Credentials
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.2" data-path="../../configure/network.md">
            
                <span>
            
                    
                    Networking
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.3" data-path="../../configure/servers.md">
            
                <span>
            
                    
                    Servers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.4" data-path="../../configure/iso.md">
            
                <span>
            
                    
                    Boot Images
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.5" data-path="../../configure/settings.html">
            
                <a href="../../configure/settings.html">
            
                    
                    Settings
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.6" data-path="../../configure/template.html">
            
                <a href="../../configure/template.html">
            
                    
                    Kickstart Templates
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="../">
            
                <a href="../">
            
                    
                    KUBAM Glorious Underbelly
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.4.1" data-path="../stage1/docker.html">
            
                <a href="../stage1/docker.html">
            
                    
                    Stage1 - Docker
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4.2" data-path="../stage1/esxi.html">
            
                <a href="../stage1/esxi.html">
            
                    
                    Stage1 - ESXi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4.3" data-path="../stage1/manual.html">
            
                <a href="../stage1/manual.html">
            
                    
                    Stage1 - Manual
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="3.4.4" data-path="python.html">
            
                <a href="python.html">
            
                    
                    Stage2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4.5" data-path="../stage3/ansible.html">
            
                <a href="../stage3/ansible.html">
            
                    
                    Stage3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4.6" data-path="../stage4/manual.html">
            
                <a href="../stage4/manual.html">
            
                    
                    Stage4
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="../../developer/">
            
                <a href="../../developer/">
            
                    
                    KUBAM Developer
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.5.1" data-path="../../developer/API.html">
            
                <a href="../../developer/API.html">
            
                    
                    KUBAM API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.5.2" data-path="../../developer/YAML.html">
            
                <a href="../../developer/YAML.html">
            
                    
                    KUBAM YAML
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../../.." >Stage2</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <p>Before continuing, be sure you have completed <a href="..">stage 1</a>.  </p>
<h1 id="1-prereqs">1. Prereqs</h1>
<ul>
<li>Python 2.7+ is required</li>
<li>The build machine could be the same as the web server machine but should be able to access UCSM with a ping.</li>
</ul>
<h1 id="2-setup">2. Setup</h1>
<h2 id="21-get-python-setup">2.1 Get Python Setup</h2>
<p>RedHat and CentOS should come with python installed by default.  You&apos;ll just need to get pip to get the UCS dependencies. </p>
<pre><code>cd /tmp/
wget https://bootstrap.pypa.io/get-pip.py
python get-pip.py
pip install ucsmsdk
</code></pre><div class="alert alert-info">
<b>Proxy Issues?</b> If you are behind a proxy you may need to enter in the proxy information for the git clone to work.  Example:   
<code>
https_proxy=proxy.esl.cisco.com:80 wget https://bootstrap.pypa.io/get-pip.py</code>
You may also need to prepend the other commands with this proxy information. 
</div>


<h2 id="22-get-the-code">2.2 Get the code:</h2>
<pre><code>yum -y install git
mkdir -p ~/Code
cd ~/Code
git clone https://github.com/ciscoucs/KUBaM.git
cd KUBaM/
</code></pre><div class="alert alert-info">
<b>Proxy Issues?</b> If you are behind a proxy you may need to enter in the proxy information for the git clone to work.  Example:   
<code>
https_proxy=proxy.esl.cisco.com:80 git clone https://github.com/ciscoucs/KUBaM.git
</code>
</div>



<h1 id="3-run-the-installation-script">3. Run the Installation Script</h1>
<pre><code>cd ~/Code/KUBaM/stage2
./kubeucs.py -o kubeblade admin nbv12345 172.28.224.163
[1] VLAN default
[2] VLAN hx-inband-mgmt
[3] VLAN hx-vmotion
[4] VLAN hx-data
[5] VLAN Docker-Data
[6] VLAN Docker-storage
[7] VLAN hx-storage-data
[8] VLAN vm-network
--------------------------------------------------------------------------------
Please Select a VLAN for the Kubernetes Server to use: 1
Creating Kubernetes MAC Pools
Creating Kubernetes VNIC Templates
Creating Kubernetes LAN connectivity policy
Creating Kube Boot Policy
Creating Kube Local Disk Policy
Creating Kube UUID Pools
Creating Kubernetes Compute Pool
Adding Virtual Media Policy
What is the URL for the Boot ISO image?
(E.g.: http://192.168.2.2/kubam/centos7.2-boot.iso) : http://172.28.225.80/kubam/rh73-boot.iso
You entered: http://172.28.225.80/kubam/rh73-boot.iso
Is this correct? [y/N]: y
Listing available UCS Servers
[1]: Blade 1/slot-3 type UCSB-B200-M3
[2]: Blade 1/slot-5 type UCSB-B200-M3
[3]: Blade 1/slot-6 type UCSB-B200-M3
[4]: Blade 1/slot-7 type UCSB-B200-M3
[5]: Blade 1/slot-8 type UCSB-B200-M3
Please select servers you want to install Kubernetes on separated by commas
(E.g: 2,4,8) :
...
</code></pre><p>Note: The &apos;-o&apos; switch in the above command defines the name of the organization you wish to create in UCSM manager.</p>
<p>At the end of this script, the servers should boot back up and be provisioned with the OS you created and be ready to go. </p>
<h2 id="troubleshooting">Troubleshooting</h2>
<p>If your blade or server displays errors like the below:</p>
<p><img src="../img/err1.png" alt="error"></p>
<p><b>&quot;Server unavailable There are not enough resources overall Insufficient disks for the specified raid level&quot;</b> and you know there are enough disks in your server then we need to let UCS know that it&apos;s ok to free those disks.  </p>
<p>This is done by going to the blade and <a href="http://www.cisco.com/c/en/us/td/docs/unified_computing/ucs/sw/gui/config/guide/2-2/b_UCSM_GUI_Configuration_Guide_2_2/configuring_storage_profiles.html#task_5325E81B0CD84790817EC6F6644ECD4A" target="_blank">Configuring Local Disk Operations as specified in the Admin Guide</a>.</p>
<p>There are two cases that may be required.  The easiest is to go to:</p>
<p>Equipment Tab &gt; Select the Server &gt; In the work pane select Inventory &gt; Storage &gt; Disks</p>
<p>Select each disk and in the field below select &quot;Set JBOD to Unconfigured Good&quot;.  If that line is grayed out, please make sure you actually click on the disk.  Do this for each of the disks to free them up. </p>
<p>If this is grayed out as well, go to: </p>
<p>Equipment Tab &gt; Select the Server &gt; In the work pane select Inventory &gt; Storage &gt; LUNS. </p>
<p>Here you can select an existing LUN and Delete it. </p>
<p><img src="../img/err2.png" alt="Delete LUN"></p>
<p>This can take about 5 minutes for the change to take effect and for the server to eventually associate with the service profile. Looking at the FSM tab on the server can get you more information as to where it is in the process. </p>
<p><img src="../img/err3.png" alt="FSM"></p>
<p>If you get an error saying &quot;Controller Does Not support out of band configuration&quot; for the UCS then you may have a C-Series system with the PCH controller.  </p>
<p><img src="../img/err4.png" alt="PCH Error"></p>
<p>The simple fix here is to create a storage controller definition as part of your storage profile.  </p>
<p><img src="../img/pch.png" alt="PCH"></p>
<p>This is a manual step as KUBaM does not currently set this up for you automatically.  </p>
<p>Finally, note there are many ways that storage can be configured including SAN boot that we have been able to compute but requires some manual work that we have not codified.  If you have such environments then you can modify storage profiles or SAN Boots to meet your needs. </p>
<h2 id="tips">Tips</h2>
<p>If you want to reinstall the servers after installing them, you can wipe them out by ssh&apos;ing into each server and running: </p>
<pre><code>dd if=/dev/zero of=/dev/sda bs=1M count=5
</code></pre><p>This will erase the master boot record.  Note that if you do this, be sure you really want to wipe out the machine.  This will make it so you do not need to change the boot order and can simply reboot the server and it will start the installation process again. </p>
<h3 id="storage-options">Storage Options</h3>
<p>KUBaM configures two disks in RAID1.  You may decide  you want more, depending on your hardware.  The easiest way to do this is to modify the Disk Group Policy in UCS.  This will allow you to use more drives and have more options.   </p>
<p>You are now ready to move to <a href="https://ciscoucs.github.io/kubam/" target="_blank">stage 3</a></p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../stage1/manual.html" class="navigation navigation-prev " aria-label="Previous page: Stage1 - Manual">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../stage3/ansible.html" class="navigation navigation-next " aria-label="Next page: Stage3">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Stage2","level":"3.4.4","depth":2,"next":{"title":"Stage3","level":"3.4.5","depth":2,"path":"kubam/internals/stage3/ansible.md","ref":"kubam/internals/stage3/ansible.md","articles":[]},"previous":{"title":"Stage1 - Manual","level":"3.4.3","depth":2,"path":"kubam/internals/stage1/manual.md","ref":"kubam/internals/stage1/manual.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"kubam/internals/stage2/python.md","mtime":"2018-03-01T20:01:16.095Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-04-25T13:26:18.457Z"},"basePath":"../../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../../gitbook/gitbook.js"></script>
    <script src="../../../gitbook/theme.js"></script>
    
        
        <script src="../../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

